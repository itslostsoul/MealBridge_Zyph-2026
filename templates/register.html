<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Registration</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Single-Leaf-Logo-Template-removebg-preview.png') }}">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: #eaf4ea; 
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', sans-serif;
        }
        .registration {
            background-color: white;
            border: 1px solid #ccc;
            text-align: left; 
            padding: 40px; 
            border-radius: 10px;
            box-sizing: border-box;
            width: 450px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .register-title { 
            font-weight: bold; 
            color: #333; 
            margin-bottom: 25px; 
            font-size: 28px; 
            text-align: center; 
        }
        .form-label { font-size: 15px; font-weight: 600; color: #1B5E20; margin-bottom: 8px; }
        .form-control { padding: 10px; border-radius: 8px; }
        .form-control:focus { border-color: #1B5E20; box-shadow: 0 0 5px rgba(27, 94, 32, 0.3); }
        
        .btn-success { width: 100%; padding: 12px; font-weight: bold; margin-top: 15px; border-radius: 8px; }
        .privacy-hint { font-size: 12px; color: #666; margin-top: 4px; }
    </style>
</head>
<body>

<div class="registration">   
    <form action="/register" method="POST">
        <div class="register-title">Join MealBridge</div>

        {% if msg %}
        <div id="errorBox" class="alert alert-danger text-center" role="alert" style="padding: 10px; font-size: 14px; font-weight: bold;">
            ‚ö†Ô∏è {{ msg }}
        </div>
        {% endif %}

        <div class="mb-3">
            <label class="form-label">I am a...</label>
            <select class="form-control" name="role" id="roleSelect" required onchange="updateForm(); hideError();">
                <option value="" disabled {% if not request.form.role %}selected{% endif %}>Select your role</option>
                <option value="donor" {% if request.form.role == 'donor' %}selected{% endif %}>Donor (Mess / Hotel / Individual)</option>
                <option value="recipient" {% if request.form.role == 'recipient' %}selected{% endif %}>Recipient (NGO / Student)</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label" id="nameLabel">Full Name</label>
            <input class="form-control" name="full_name" id="nameInput" type="text" placeholder="Enter your name" 
                   value="{{ request.form.full_name }}" required oninput="hideError()">
        </div>

        <div class="mb-3">
            <label class="form-label" id="idLabel">Verification ID</label>
            <input class="form-control" name="license_id" id="idInput" type="text" placeholder="Select role first..." 
                   value="{{ request.form.license_id }}" required oninput="hideError()">
            <div class="privacy-hint" id="privacyHint">We encrypt your data for safety. üîí</div>
        </div>

        <div class="mb-3">
            <label class="form-label">Email Address</label>
            <input class="form-control" name="email" type="email" placeholder="e.g. mess@srm.edu" 
                   value="{{ request.form.email }}" required oninput="hideError()">
        </div>

        <div class="mb-3">
            <label class="form-label">Password</label>
            <input class="form-control" name="password" type="password" placeholder="Create a password" required oninput="hideError()">
        </div>

        <div class="mb-3">
            <label class="form-label">Confirm Password</label>
            <input class="form-control" name="confirm_password" type="password" placeholder="Repeat password" required oninput="hideError()">
        </div>

        <div>
             <button class="btn btn-success" type="submit">Create Account</button>
        </div>

        <div style="margin-top: 15px; font-size: 14px; text-align: center;">
            Already have an account? 
            <a href="{{ url_for('login') }}" style="color: #1B5E20; font-weight: bold;">Login Here</a>
        </div>
    </form>
</div>

<script>
    function hideError() {
        var box = document.getElementById("errorBox");
        if (box) {
            box.style.display = 'none';
        }
    }

    function updateForm() {
        var role = document.getElementById("roleSelect").value;
        var nameLabel = document.getElementById("nameLabel");
        var nameInput = document.getElementById("nameInput");
        var idLabel = document.getElementById("idLabel");
        var idInput = document.getElementById("idInput");
        var privacyHint = document.getElementById("privacyHint");

        if (role === "donor") {
            nameLabel.innerHTML = "Organization or Individual Name";
            nameInput.placeholder = "e.g. SRM Canteen OR John Doe";
            idLabel.innerHTML = "FSSAI License / Aadhaar (Last 4 Digits)";
            if (!idInput.value) idInput.placeholder = "e.g. XXXX-XXXX-1234"; 
            privacyHint.innerHTML = "For Individuals: Only enter the last 4 digits for privacy.";
        } else if (role === "recipient") {
            nameLabel.innerHTML = "NGO / Student Name";
            nameInput.placeholder = "e.g. Green NGO OR Rahul Kumar";
            idLabel.innerHTML = "NGO Reg No. / College ID";
            if (!idInput.value) idInput.placeholder = "e.g. RA221100..."; 
            privacyHint.innerHTML = "We verify this with your institution.";
        }
    }

    window.onload = function() {
        if (document.getElementById("roleSelect").value) {
            updateForm();
        }
    };
</script>

</body>
</html>